# 经验沉淀技能设计方案

> **目的**: 设计一个核心技能，指导 AI 如何将有价值的知识沉淀为可复用的技能文件

---

## 一、技能定位

| 属性 | 值 |
|-----|---|
| 技能名称 | `knowledge-deposit` |
| 存放位置 | `~/.gemini/antigravity/skills/knowledge-deposit/` |
| 触发时机 | 任务结束时由 AI 自动评估 |
| 核心功能 | 判断、提取、检索、创建/更新技能文件 |

---

## 二、技能需要的能力

### 2.1 判断能力
判断当前任务是否值得沉淀：

| 沉淀条件 | 检测方式 |
|---------|---------|
| 经历试错 | 任务过程中有失败→成功的记录 |
| 调试耗时 | 对话轮次 > 5 |
| 非常规解法 | 使用了项目特有方案 |
| 用户主动要求 | 用户说"记住"、"保存" |

### 2.2 提取能力
从对话中提取沉淀内容：

| 提取项 | 说明 |
|-------|------|
| 问题描述 | 遇到了什么问题 |
| 问题现象 | 表现是什么 |
| 根因分析 | 为什么会出现 |
| 解决步骤 | 怎么解决的 |
| 相关文件 | 涉及哪些文件 |
| 关键代码 | 核心代码片段 |

### 2.3 检索对比能力
沉淀前检索现有技能：

1. 扫描 `~/.gemini/antigravity/skills/` 下所有技能
2. 读取每个技能的 `SKILL.md` 中的 `description`
3. 对比新知识与现有技能的相似度
4. 决定：创建新技能 / 更新已有技能 / 跳过

### 2.4 创建/更新能力
生成规范的技能文件：

```yaml
---
name: problem-name
description: |
  简洁的问题描述和触发场景
source: 实际调试验证
confidence: high
last_verified: 2026-01-16
---

# 问题标题

## 问题现象
...

## 根因
...

## 解决步骤
...
```

---

## 三、是否需要辅助脚本

### 方案对比

| 方案 | 说明 | 优点 | 缺点 |
|-----|------|-----|------|
| **A: 纯指令** | SKILL.md 只包含文字指令，AI 直接执行 | 简单、无依赖 | AI 需要自己写代码扫描目录 |
| **B: 辅助脚本** | 包含脚本扫描技能库、创建文件 | 标准化、可复用 | 增加复杂度 |

### 建议：方案 A（纯指令）

理由：
1. AI 已经具备读写文件的能力
2. 扫描目录、读取文件是简单操作
3. 避免维护额外脚本
4. 保持技能的轻量和可移植

---

## 四、SKILL.md 结构设计

```
~/.gemini/antigravity/skills/knowledge-deposit/
└── SKILL.md
```

### 4.1 description 设计（关键）

```yaml
description: |
  经验沉淀技能。在任务成功完成后，评估是否需要将解决方案
  保存为可复用的技能。触发条件：任务结束、用户说"记住这个"、
  解决问题过程有试错。
```

### 4.2 核心指令内容

1. **沉淀评估流程**
2. **信息提取模板**
3. **检索对比方法**
4. **技能文件创建规范**
5. **用户确认流程**

---

## 五、完整执行流程

```
任务结束
    ↓
[评估阶段]
├── 检查是否满足沉淀条件
├── 评估沉淀价值分数
└── 不满足条件 → 静默结束
    ↓ 满足条件
[提取阶段]
├── 从对话中提取问题描述
├── 提取解决方案关键步骤
└── 生成技能 description
    ↓
[检索阶段]
├── 列出 ~/.gemini/antigravity/skills/ 目录
├── 读取每个技能的 SKILL.md 的 YAML 头部
├── 对比 description 相似度
└── 判断：新建 / 更新 / 跳过
    ↓
[确认阶段]
├── 向用户展示沉淀内容摘要
├── 询问是否确认保存
└── 用户拒绝 → 结束
    ↓ 用户确认
[创建阶段]
├── 创建技能目录
├── 写入 SKILL.md 文件
└── 输出保存路径
```

---

## 六、待确认问题

1. **技能命名规则**：如何自动生成规范的技能名称？
   - 建议：从问题描述提取关键词，用连字符连接，如 `firebase-mobile-login-fix`

2. **相似度阈值**：多高算"高度相似"？
   - 建议：AI 自行判断，无需精确数值

3. **是否需要用户选择保存位置**：全局 vs 项目级？
   - 建议：默认全局，除非明显只属于当前项目

## 七、配置信息处理

### 7.1 区分两类技能

| 类型 | 说明 | YAML 字段 |
|-----|------|----------|
| 不需要配置 | 纯知识类，无密码/IP | 无需添加 |
| 需要配置 | 涉及密码、密钥、IP | `requires_config: true` |

### 7.2 需要配置的技能写法

1. YAML 头部添加 `requires_config: true`
2. 正文开头添加"环境要求"章节
3. 使用 `${描述}` 引用配置值（如 `${小米路由器密码}`）

### 7.3 配置提醒流程

创建需要配置的技能时：
1. 检查 `~/.gemini/secrets.env` 是否已有所需配置
2. 如不存在，提醒用户添加（给出示例格式）

---

## 八、实践验证结果

✅ **已验证通过**（2026-01-16）

- 创建了 `knowledge-deposit` 核心技能
- 创建了 `xiaomi-shellclash-node-update` 业务技能
- 成功测试了从 `secrets.env` 读取配置并执行任务
- 验证了技能触发、执行、配置读取的完整流程

