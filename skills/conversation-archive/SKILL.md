---
name: conversation-archive
description: |
  å¯¹è¯å½’æ¡£æŠ€èƒ½ã€‚åœ¨ç”¨æˆ·å®Œæˆå·¥ä½œæˆ–æ˜ç¡®è¦æ±‚ä¿å­˜æ—¶ï¼Œå¼•å¯¼ç”¨æˆ·å¯¼å‡ºå¯¹è¯å¹¶å½’æ¡£ã€‚
  è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·è¯´"ä¿å­˜å¯¹è¯"/"å½’æ¡£"/"è®°å½•ä¸€ä¸‹"ï¼Œæˆ–æ£€æµ‹åˆ°ç¦»å¼€æ„å›¾ï¼ˆ"ä»Šå¤©å°±åˆ°è¿™"/"æäº¤ä»£ç å§"ï¼‰ã€‚
  ç”¨äºæŒ‡å¯¼ AI å¦‚ä½•æ­£ç¡®åœ°å½’æ¡£å¯¹è¯è®°å½•ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³æå–å’Œç´¢å¼•ç®¡ç†ã€‚
compatibility: Antigravity IDE, Claude Code, Gemini CLI, OpenAI Codex, iFlow CLI
metadata:
  author: lanstar128
  version: "1.0"
---

# å¯¹è¯å½’æ¡£æŠ€èƒ½

æœ¬æŠ€èƒ½æŒ‡å¯¼ AI åœ¨ç”¨æˆ·å®Œæˆå·¥ä½œæ—¶ï¼Œå¼•å¯¼ç”¨æˆ·å¯¼å‡ºå¯¹è¯å¹¶è¿›è¡Œå½’æ¡£å¤„ç†ã€‚

> [!IMPORTANT]
> æœ¬æŠ€èƒ½æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
> 1.  **æ–‡ä»¶å¯¼å…¥æ¨¡å¼ (æ¨è)**ï¼šé€‚ç”¨äº Antigravity IDEï¼Œç”¨æˆ·æ‰‹åŠ¨å¯¼å‡º Markdown æ–‡ä»¶ï¼Œå®Œæ•´ä¿ç•™å¯¹è¯ã€‚
> 2.  **è‡ªæˆ‘è½¬è¿°æ¨¡å¼ (å…¼å®¹)**ï¼šé€‚ç”¨äº Claude Code / Codex / iFlow ç­‰ä¸æ”¯æŒå¯¼å‡ºçš„å¹³å°ï¼Œç”± AI è‡ªåŠ¨æ€»ç»“å¹¶å†™å…¥æ–‡ä»¶ã€‚

---

## ä¸€ã€è§¦å‘æ¡ä»¶

### 1.1 ä¸»åŠ¨è§¦å‘ï¼ˆç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼‰
- ç”¨æˆ·è¯´"ä¿å­˜å¯¹è¯"ã€"å½’æ¡£ä¸€ä¸‹"ã€"è®°å½•è¿™æ¬¡å¯¹è¯"
- ç”¨æˆ·è¯´"å¸®æˆ‘ä¿å­˜"ã€"å­˜ä¸€ä¸‹"

### 1.2 è¢«åŠ¨è§¦å‘ï¼ˆæ£€æµ‹åˆ°ç¦»å¼€æ„å›¾ï¼‰
- ç”¨æˆ·è¯´"ä»Šå¤©å°±åˆ°è¿™"ã€"æˆ‘å…ˆå¿™äº†"ã€"ä¸‹æ¬¡ç»§ç»­"
- ç”¨æˆ·è¯´"æäº¤ä»£ç å§"ã€"commit ä¸€ä¸‹"
- æ˜æ˜¾çš„ä»»åŠ¡å®Œæˆè¿¹è±¡

---

## äºŒã€æ‰§è¡Œæµç¨‹
æ£€æŸ¥å½“å‰ç¯å¢ƒæˆ–è¯¢é—®ç”¨æˆ·æ˜¯å¦ä½¿ç”¨ Antigravity IDEã€‚

### ğŸŸ¡ æƒ…å†µ Aï¼šAntigravity IDE (æ–‡ä»¶å¯¼å…¥æ¨¡å¼)
**é€‚ç”¨æ¡ä»¶**ï¼šå½“å‰æ˜¯ Antigravity IDE æˆ–ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å¯¼å‡º `.md` æ–‡ä»¶ã€‚

#### 1. å¼•å¯¼ç”¨æˆ·å¯¼å‡º
```
æ£€æµ‹åˆ°æ‚¨å‡†å¤‡ç»“æŸæœ¬æ¬¡å¯¹è¯ã€‚æ˜¯å¦éœ€è¦å½’æ¡£ï¼Ÿ

å¦‚éœ€å½’æ¡£ï¼Œè¯·ï¼š
1. ç‚¹å‡»å¯¹è¯çª—å£å³ä¸Šè§’çš„ "Export" æŒ‰é’®
2. ä¿å­˜åˆ°é»˜è®¤ä½ç½® (~/Downloads/)
3. å®Œæˆåå‘Šè¯‰æˆ‘"å¯¼å‡ºå¥½äº†"
```

#### 2. æ£€æµ‹å¯¼å‡ºæ–‡ä»¶
ç”¨æˆ·ç¡®è®¤åï¼Œæ‰«æä¸‹è½½ç›®å½•ï¼š
```bash
ls -lt ~/Downloads/*.md | head -5
```
- æŸ¥æ‰¾æœ€è¿‘ 5 åˆ†é’Ÿå†…ä¿®æ”¹çš„ `.md` æ–‡ä»¶
- æ–‡ä»¶åæ ¼å¼ï¼š`{å¯¹è¯æ ‡é¢˜}.md`

#### 3. æå–æ—¶é—´æˆ³å…ƒæ•°æ®
> [!CAUTION]
> **å…³é”®æ­¥éª¤ï¼šæ—¶é—´æˆ³å¿…é¡»ä» ADDITIONAL_METADATA ä¸­æå–ï¼**

æ¯æ¡ç”¨æˆ·æ¶ˆæ¯çš„ `<ADDITIONAL_METADATA>` å—ä¸­åŒ…å«ï¼š
```xml
<ADDITIONAL_METADATA>
The current local time is: 2026-01-18T11:43:11+08:00
...
</ADDITIONAL_METADATA>
```

**éƒ¨åˆ†æ—¶é—´æˆ³æ¢å¤**ï¼š
- å¦‚æœå¯¹è¯**å…¨éƒ¨åœ¨ active context ä¸­**ï¼šå¯ä»¥å®Œç¾æ¢å¤æ‰€æœ‰æ—¶é—´æˆ³
- å¦‚æœå¯¹è¯**è¿‡é•¿è¢«æˆªæ–­**ï¼šåªèƒ½æ¢å¤æœ€è¿‘éƒ¨åˆ†çš„æ—¶é—´æˆ³
- æ¢å¤ç­–ç•¥ï¼šä»å½“å‰å†…å­˜ä¸­æå–èƒ½æ‰¾åˆ°çš„æ—¶é—´æˆ³ï¼Œå…¶ä½™ç•™ç©º
- **ç¼ºå°‘æ—¶é—´æˆ³ä¸å½±å“å½’æ¡£å’Œæ£€ç´¢åŠŸèƒ½**

**è¾“å‡º JSON æ ¼å¼**ï¼š
```json
{
  "conversation_title": "å¯¹è¯æ ‡é¢˜",
  "archive_time": "2026-01-18 11:50",
  "project_path": "/Users/.../project",
  "turns": [
    {"index": 1, "time": "2026-01-18 09:55", "first_line": "ç”¨æˆ·ç¬¬ä¸€å¥è¯..."},
    {"index": 2, "time": "2026-01-18 10:30", "first_line": "ç”¨æˆ·ç¬¬äºŒå¥è¯..."}
  ]
}
```

#### 4. è°ƒç”¨è„šæœ¬å¤„ç†
**æ­¥éª¤ 1ï¼šåˆ›å»ºä¸´æ—¶å…ƒæ•°æ®æ–‡ä»¶**
```bash
cat > /tmp/archive_metadata.json << 'EOF'
{ä¸Šä¸€æ­¥çš„ JSON å†…å®¹}
EOF
```

**æ­¥éª¤ 2ï¼šæ‰§è¡Œå½’æ¡£è„šæœ¬**
```bash
# æ³¨å…¥æ—¶é—´æˆ³å¹¶ä¿å­˜åˆ°å…¨å±€ç›®å½•
python3 ~/.gemini/skills/conversation-archive/scripts/inject_timestamps.py \
  --source ~/Downloads/å¯¹è¯æ ‡é¢˜.md \
  --metadata /tmp/archive_metadata.json \
  --output ~/.gemini/memory/conversations/

# æ›´æ–°å…¨å±€ç´¢å¼•
python3 ~/.gemini/skills/conversation-archive/scripts/db_manager.py \
  --action add \
  --metadata /tmp/archive_metadata.json \
  --file <è¾“å‡ºçš„å½’æ¡£æ–‡ä»¶è·¯å¾„>

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm /tmp/archive_metadata.json

# å»é‡æ£€æŸ¥
python3 ~/.gemini/skills/conversation-archive/scripts/dedup_archives.py \
  --dir ~/.gemini/memory/conversations/<å¹´-æœˆ>/
```

---

### ğŸŸ¢ æƒ…å†µ Bï¼šå…¶ä»–å¹³å° (è‡ªæˆ‘è½¬è¿°æ¨¡å¼)
**é€‚ç”¨æ¡ä»¶**ï¼šgemini CLI, Claude Code, Codex, iFlowï¼Œæˆ–æ— æ³•å¯¼å‡ºæ–‡ä»¶çš„ç¯å¢ƒã€‚

#### 1. ç”Ÿæˆå¯¹è¯æ‘˜è¦
AI è‡ªåŠ¨è¯»å–å½“å‰ä¸Šä¸‹æ–‡ï¼Œæ€»ç»“ä»¥ä¸‹å†…å®¹ï¼š
- **æ—¥æœŸ**ï¼šå½“å‰æ—¥æœŸ (YYYY-MM-DD)
- **æ ‡é¢˜**ï¼šä¸ºå¯¹è¯èµ·ä¸€ä¸ªç®€çŸ­æ ‡é¢˜
- **æ‘˜è¦**ï¼šæ ¸å¿ƒé—®é¢˜ã€è§£å†³æ­¥éª¤ã€å…³é”®ä»£ç 
- **å¯¹è¯åŸæ–‡**ï¼šå°½å¯èƒ½å¤è¿°å…³é”®çš„é—®ç­”å¯¹

#### 2. å†™å…¥å½’æ¡£æ–‡ä»¶
ç›´æ¥å°†å†…å®¹å†™å…¥æ–‡ä»¶ï¼ˆæ³¨æ„ï¼šæ–‡ä»¶åå¿…é¡»åŒ…å«æ—¥æœŸï¼Œå¦‚ `2026-01-19_Title.md`ï¼‰ï¼š

```bash
mkdir -p ~/.gemini/memory/conversations/$(date +%Y-%m)

cat > ~/.gemini/memory/conversations/$(date +%Y-%m)/$(date +%Y-%m-%d)_<æ ‡é¢˜>.md << 'EOF'
---
date: $(date +%Y-%m-%d %H:%M)
source: ai-self-archive
---
# <æ ‡é¢˜>

## æ‘˜è¦
<æ‘˜è¦å†…å®¹>

## å¯¹è¯è®°å½•
<AI å¤è¿°çš„å¯¹è¯å†…å®¹>
EOF
```

#### 3. æ›´æ–°ç´¢å¼•
```bash
# æ‰‹åŠ¨æ„é€  JSON å…ƒæ•°æ®ä¼ é€’ç»™ db_manager
cat > /tmp/archive_metadata.json << 'EOF'
{
  "conversation_title": "<æ ‡é¢˜>",
  "archive_time": "$(date +%Y-%m-%d %H:%M)",
  "project_path": "$(pwd)",
  "turns": [] 
}
EOF

python3 ~/.gemini/skills/conversation-archive/scripts/db_manager.py \
  --action add \
  --metadata /tmp/archive_metadata.json \
  --file ~/.gemini/memory/conversations/$(date +%Y-%m)/$(date +%Y-%m-%d)_<æ ‡é¢˜>.md

rm /tmp/archive_metadata.json
```

---

### ğŸ”„ é€šç”¨åç»­æ­¥éª¤ (æ‰€æœ‰æ¨¡å¼)

**è‡ªåŠ¨åŒæ­¥åˆ°è¿œç¨‹**
```bash
git -C ~/.gemini add . && git -C ~/.gemini commit -m "auto: archive conversation" && git -C ~/.gemini push
```

### 2.5 ç¡®è®¤å®Œæˆ
```
âœ… å¯¹è¯å·²å½’æ¡£

ä½ç½®: ~/.gemini/memory/conversations/2026-01/2026-01-18_å¯¹è¯æ ‡é¢˜.md
å¯¹è¯è½®æ•°: N è½®
æ—¶é—´èŒƒå›´: 09:55 - 11:50

å…¨å±€ç´¢å¼•å·²æ›´æ–°ï¼Œå¯éšæ—¶æ£€ç´¢å†å²å¯¹è¯ã€‚
```

---

## ä¸‰ã€å­˜å‚¨ç»“æ„

```
~/.gemini/memory/
â”œâ”€â”€ conversations/          # å¯¹è¯åŸæ–‡
â”‚   â”œâ”€â”€ 2026-01/
â”‚   â”‚   â””â”€â”€ 2026-01-18_å¯¹è¯å½’æ¡£æŠ€èƒ½è®¨è®º.md
â”‚   â””â”€â”€ 2026-02/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ conversations.db        # SQLite ç´¢å¼•
â””â”€â”€ index_backup.json       # JSON å¤‡ä»½
```

> [!NOTE]
> æ‰€æœ‰å¯¹è¯ä¿å­˜åœ¨å…¨å±€ç›®å½•ï¼Œä¾¿äºç»Ÿä¸€å¤‡ä»½å’Œè·¨è®¾å¤‡åŒæ­¥ã€‚

---

## å››ã€æ£€ç´¢å†å²å¯¹è¯

å½“ç”¨æˆ·éœ€è¦æŸ¥æ‰¾å†å²å¯¹è¯æ—¶ï¼š
```bash
python3 ~/.gemini/skills/conversation-archive/scripts/db_manager.py \
  --action search \
  --keyword "å…³é”®è¯" \
  --date-range "2026-01-01,2026-01-31"
```

---

## äº”ã€ç›¸å…³è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ |
|------|------|
| `scripts/inject_timestamps.py` | å°†æ—¶é—´æˆ³æ³¨å…¥ Markdown æ–‡ä»¶ |
| `scripts/db_manager.py` | SQLite ç´¢å¼•ç®¡ç†ï¼ˆå¢åˆ æŸ¥ï¼‰ |

---

*Created: 2026-01-18*
